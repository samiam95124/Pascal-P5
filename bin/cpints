#!/bin/bash
#
# Script to run a pint self compile
#
# Run macro preprocessor to configure source for self compile.
#
call pascpp source\pint -DWRDSIZ32 -DSELF_COMPILE
#
# Compile the final target, the PAT
#
echo Compiling the ISO 7185 PAT
compile standard_tests/iso7185pat
cat standard_tests/iso7185pat.err
#
# Compile pint itself
#
echo Compiling pint to intermediate code
compile pintm
cat pintm.err
#
# Add the final target program (the pat) to the end of pint.
# This means that the version of pint will read and interpret
# this.
#
cat pintm.p5 standard_tests/iso7185pat.p5 > tmp.p5
rm pintm.p5
mv tmp.p5 pintm.p5
#
# Create input file
#
cp standard_tests/iso7185pat.inp source/pint.mpp.inp
#
# Now run pint on pint, which runs the PAT.
#
echo Running pint on itself, to run the ISO 7185 PAT
run pintm
cp pintm.lst standard_tests/iso7185pats.lst
echo -n "Comparing PAT result to reference ... "
diffnole standard_tests/iso7185pats.lst standard_tests/iso7185pats.cmp > standard_tests/iso7185pats.dif
if test -s iso7185pats.dif
then
    echo FAILED
else
    echo PASS
fi
