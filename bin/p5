#!/bin/bash
#
# Compile with P5 using GPC Pascal
#
# Execute with:
#
# p5 <sourcefile> [<inputfile>[<outputfile>]]
#
# Where <file> is the name of the source file without
# extention. The Pascal file is compiled and run.
# Any compiler errors are output to the screen. Input
# and output to and from the running program are from
# the console, but output to the prr file is placed
# in <file>.out.
#
# The intermediate code is placed in <file>.p5.
#
# If <inputfile> and <outputfile> are specified, then these will be
# placed as input to the "prd" file, and output from the "prr" file.
# Note that the prd file cannot or should not be reset, since that
# would cause it to back up to the start of the intermediate code.
#

if [ -z "$1" ]
then

   echo "*** Error: Missing parameter"
   exit 1

fi

if [ ! -f "$1.pas" ]
then

   echo "*** Error: Missing $1.pas file"
   exit 1

fi

if [ ! -z "$2" ]
then

    if [ ! -f "$2" ]
    then
    
        echo "*** Input file $2 does not exist"
        
    fi
    
fi

echo
echo Compiling and running $1
echo
cp $1.pas prd
pcom < $1.pas
mv prr $1.p5
if [ ! -z "$2" ]
then

    # The input file, if it exists, gets put on the end of the intermediate
    cat $1.p5 $2 > prd

else

    cp $1.p5 prd
    
fi
pint
if [ ! -z "$3" ]

    cp prr %3
    
fi
rm prd
rm prr
